@model Sys_Meeting.Models.MeetMaintenanceModels

@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
    <link rel="shortcut icon" href="../../Content/favicon.ico" type="image/x-icon" />
    <link href="../../Content/jquery-plugin/themes/metro/easyui.css" rel="stylesheet"
        type="text/css" />
    <link href="../../Content/jquery-plugin/themes/icon.css" rel="stylesheet" type="text/css" />
    <link href="../../Content/jquery-plugin/demo/demo.css" rel="stylesheet" type="text/css" />


    <script type="text/javascript" src="~/Scripts/jquery-1.7.1.min.js"></script>
  
    <script src="../../Content/jquery-plugin/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="../../Content/jquery-plugin/locale/easyui-lang-zh_TW.js" type="text/javascript"></script>
    @*<style type="text/css">
        div#listPanels {
            padding: 2px;
            float: right;
        }
    </style>*@
@*    <style type="text/css">
        div#add-list-proc {
            padding: 2px;
        }
         div#add-list-proc td{
             width: 1px;
         }
    </style>*@
</head>
    <body>
        <br/>
        @*>--操作搜索*@
        <div id="meetlistcontent">
            <select id="cc" style="width: 150px;"></select>
            <input class="easyui-textbox" data-options="prompt:'關鍵字...'," style="width: 450px; height: 24px;">
            <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search" id="btnQuery">搜索</a>
            <div id="sp">
                <div style="color: #99BBE8; background: #fafafa; padding: 5px;">請選擇查詢條件：</div>
                <div style="padding: 10px">
                    <input type="radio" name="lang" value="01" /><span>會議編號</span><br/>
                </div>
            </div>
                
            <br/>
            <hr/>
            <input type="button" value="新增" id="btnCreate"/>
            <input type="button" value="修改" id="btnEdit"/>
            <input type="button" value="刪除" id="btnDelete"/>
        </div>
        @*操作搜索--<*@
        
        @*-->表格*@
        <div style="border: 0px solid red;width: 100%;height: 500px;">
            <table id="dg" title="會議列表" style="width: 100%"></table>
        </div>
        @*表格--<*@
        
        <div id="awesome">
            <input id="txtValue1" value="" data-myid="1"/>
            <input id="txtValue2" value="" data-myid="2"/>
            <input id="txtValue3" value="" data-myid="3"/>
            <input id="txtValue4" value="" data-myid="4"/>
            <input id="txtValue5" value="" data-myid="5"/>
            <input id="txtValue6" value="" data-myid="6"/>
            <input id="txtValue7" value="" data-myid="7"/>
        </div>
        <input type="button" id="btntestdata" value="testdata"/>
        <script>
            $('#btntestdata').click(function() {
                var d = $('#awesome').data('myid');
                //alert(d);
                $('#awesome input').each(function () {
                    var d1 = $(this).data('myid');
                    console.log(d1);
                    alert(d1);
                    $(this).val('');
                });

            })
        </script>
        
        @*>--新增會議界面*@
        <div id="add-list-proc" title="新增事項" style="display: none" >
            <table style="width: 100%;padding-left: 7px;">
                <tr>
                    <td width="7%">會議編號：*</td>
                    <td width="20%"><input type="text" value="" id="txtId" data-valid="會議編號"/>
                    </td>
                    <td width="6%">會議日期：*</td>
                    <td width="67%"><input id="txtDte" class="easyui-datebox" style="width: 100px"></input></td>
                </tr>
                <tr>
                    <td>會議時間：*</td>
                    <td><input type="text" value="" id="txtTime" data-valid="會議時間"/></td>
                    <td>會議地點：*</td>
                    <td><input type="text" value="" id="txtAddr" data-valid="會議地點"/></td>

                </tr>
                <tr>
                    <td>主席：*</td>
                    <td colspan="3"><input readonly="true" type="text" value="" id="txtMaster" style="width: 60%" data-valid="主席"/><a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" onclick="OpenSearch('txtMaster')"></a>

                        <input type="hidden" value="" id="txtMaster_f" style="width: 60%" data-valid="主席" readonly="true"/>    
                    </td>
                    
                </tr>
                <tr>
                    <td>出席：*</td>
                    <td colspan="3"><input readonly="true" type="text" value="" id="txtJoins" style="width: 60%" data-valid="出席"/><a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" onclick="OpenSearch('txtJoins')"></a>
                        <input type="hidden" value="" id="txtJoins_f" style="width: 60%" data-valid="出席"/>
                    </td>
                </tr>
                <tr>
                    <td>缺席人員：</td>
                    <td colspan="3"><input readonly="true" type="text" value="" id="txtUnJoins" style="width: 60%" /><a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" onclick="OpenSearch('txtUnJoins')"></a>
                        <input type="hidden" value="" id="txtUnJoins_f" style="width: 60%" />
                    </td>

                </tr>
                <tr>
                    <td>會議名稱：*</td>
                    <td colspan="3"><input type="text" value="" id="txtName" style="width: 60%" data-valid="會議名稱"/></td>
                </tr>
                <tr>
                    <td>共享指定人：</td>
                    <td><input id="chkShare" type="checkbox" /><input id="txtShareList" type="text" /></td>
                </tr>
            </table>
            
            <input type="text" value="" id="txtAction"/>
            <input type="text" value="" id="txtSysId"/>
            <hr/>
            <div id ="mtMenu" style="padding-left: 7px;">會議事項：<input id="txtMtListId" type="text" value=""/><input id="txtMtListSysId" type="text" value=""/>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search" id="btnQueryList">查詢</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" id="btnAddPanels" onclick="addPanels()">添加</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" id="btnRemovePanel" onclick="removePanel()">刪除</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" id="btnExists" onclick="ListExists()">檢查</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" id="btnGetGuid" onclick="GetGuid()">GetGUID</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" id="btnGetValues" onclick="GetValues()">GetValues</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" id="btnGetValues" onclick="GetValuesDetail()">GetValuesDetail</a>
            </div>
            <br/>

            @*>--多面板展開*@
            @*<div id="listPanels" style="border: 1px solid red" >*@
            @*會議內容：<textarea cols="100" rows="5" id="txtListTitle"></textarea>*@
            @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" id="btnAddPanels" onclick="addPanels()">添加</a>*@
            @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" id="btnRemovePanel" onclick="removePanel()">刪除</a>*@
            @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" id="btnSelectPanel" onclick="selectPanel()" style="margin-bottom: 20px;">選擇</a>*@
            @*</div>*@
            <hr/>

            <div id="meetlistpanels" class="easyui-accordion" @*data-options="multiple:true"*@ style="width:80%;height:300px;">
                @*<div title="事項1" data-options="iconCls:'icon-ok'" style="overflow:auto;padding:1px;">*@
                @*<p>事項內容</p>
                    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" id="btnAddPanels2" onclick="addPanels()" style="margin-bottom: 20px;">添加</a>
                    *@
                @*<textarea cols="100" rows="4" id="txtMtContent1"></textarea>
                </div>*@
                
                @*-->可異步加載*@
                @*<div title="事項2" style="padding:10px;" data-options="href:'/meet/list/'">
                    <p>事項內容</p>
                </div>
                *@
                @*可異步加載--<*@

            </div>
            @*多面板展開--<*@

        </div>
        @*新增會議界面--<*@
        
        <div id="acc-search-form"></div>
        
        <script type="text/javascript">
            /*<script type="text/javascript">*/
            var mode = '';
            var panelIdx = 1;
            var curOpenSearchName = '';

            //>--搜索模塊****************************************************************//
            //****************************************************************

            //o:表格對象名稱
            function GetSearch(o,u,cols) {
                alert(cols);
                $(o).datagrid({
                    url: u,
                    singleSelect: false,
                    width: '900px',
                    height: '500px',
                    pagination: true,
                    rownumbers: true,
                    pageSize: 10,
                    pageList: [5, 10, 15, 20],
                    remoteSort: false,
                    fit: true,
                    columns: [[{ field: 'ck', title: '用戶編號', width: 100, checkbox: true }
                    ,{ field: 'wor_num', title: '用戶編號', width: 100 }
                    ,{ field: 'ful_name', title: '名稱', width: 100 }]],
                    //columns:cols,//[cols],
                    onDblClickRow: function(rowIdx, rowData) {
                        $(curOpenSearchName + '_f').val(rowData.wor_num);
                        $(curOpenSearchName).val(rowData.ful_name);
                        CloseDialog('#acc-search-form');
                    }
                });
            }

            //獲取選擇表格的行數
            //d:表格對象名稱
            //返回行為數組
//            function GetDGSelections(d) {
//                var rrows=[];
//                var rows = $(d).datagrid('getSelections');
//                for (var i = 0; i < rows.length; i++) {
//                    var row = rows[i];
//                    rrows.push(row);
//                }
//                return rrows;
//            }

            function CloseDialog(o) {
                $(o).dialog('close');
            }

            function OpenSearch(o) {
                //OpenSearchDailog(o, '#acc-search-form','#dgSearch','/account/search/','會議內容', GetDGSelections);
                OpenSearchDailog(o, '#acc-search-form', '#dgSearch', '/account/search/', '會議內容', function(d) {
                    var rows = $(d).datagrid('getSelections');
                    var worid=[],fulname=[];
                    for (var i = 0; i < rows.length; i++) {
                        var row = rows[i];
                        worid.push(row.wor_num);
                        fulname.push(row.ful_name);
                    }
                    $(curOpenSearchName).val(fulname.join(','));
                    $(curOpenSearchName + '_f').val(worid.join(','));
                    CloseDialog('#acc-search-form');
//                    alert(worid.join(',') + '|' + fulname.join(','));
                });
            }

            //返回值為表格的選擇行，數組類型
            function OpenSearchDailog(o,div,d,url,t,fn) {
                curOpenSearchName = '#'+o;
                $(div).show().dialog({
                    modal: true,
                    width: 500,
                    height: 400,
                    title: t,//'會議內容',
                    href:url,// '/account/search/',
                    cache: false,
                    collapsible: false,
                    minimizable: false,
                    maximized: false,
                    resizable: true,
                    toolbar: [
                        {
                            text: '選擇',
                            iconCls: 'icon-ok',
                            handler: function() {
                                fn(d);
                            }
                        }, '-', {
                            text: '關閉',
                            iconCls: 'icon-no',
                            handler: function() {
                                CloseDialog(div);                      
                            }
                        }
                    ]
                });
            }

            //****************************************************************
            //****************************************************************搜索模塊--<//

            $('#btnQueryList').click(function() {
                OpenSearchDailog('txtQueryListId', '#acc-search-form', '#dgSearch', '/list/index', '事項列表', function(d) {
                    alert(d);
                });
            });

            function removePanel() {
                var o = '#meetlistpanels';
                var pp = $(o).accordion('getSelected');
                if (pp) {
                    var index = $(o).accordion('getPanelIndex', pp);
                    //                    alert(index);
                    $(o).accordion('remove', index);
                }
            }

            //            function selectPanel() {
            //                var s = $('#txtMtListId').val();
            //                alert(s);
            //                var b=$('#meetlistpanels').accordion('select',s);
            //                alert(b);
            //            }

            //創建會議
            $('#btnCreate').click(function () {
                mode = 'create';

                ClearValue('#add-list-proc input');

                $("#txtId").removeAttr("disabled");
                $('#txtAction').val(mode);
                GetGuid();
                //                if (CheckIsSave()) {
                //var o = new ContainerModel();
                var d = '#add-list-proc';
                var u = '/meetmaintenance/action';
                openDailog(d, u, HandlerDone);

                //                }
            });

            //修改
            $('#btnEdit').click(function () {
                $("#txtId").attr("disabled", "disabled");
            });

            //刪除
            $('#btnDelete').click(function () {

            });

            //檢查
            function CheckIsSave() {
                var b = true;
                $('#add-list-proc input').each(function() {
                    var o = $(this).data('valid');
                    if (o) {
                        if ($.trim($(this).val()) == '') {
                            $.messager.alert('提示', o + '不能為空', 'info');
                            b = false;
                            return false;
                        }
                    }
                });
                return b;
//                return true;
            }

            function ContainerModel() {
                var self = this;
                self.id = $('#txtId').val();
                self.date=$('#txtDte').val();
                self.time = $('#txtTime').val();
                self.addr = $('#txtAddr').val();
                self.master = $('#txtMaster_f').val();
                self.joins = $('#txtJoins_f').val();
                self.unjoins = $('#txtUnJoins_f').val();
                self.name = $('#txtName').val();
                self.sharelist = $('#txtShareList').val();
                self.action = $('#txtAction').val();
                self.sysid = $('#txtSysId').val();

                //                console.log(self.id);
                //                console.log(self.name);
                //                console.log(self.action);
                //                console.log(self.sysid);
            }

            function ClearValue(o) {
                $(o).each(function () {
                    $(this).val('');
                });
            }

            function HandlerDone() {
                ClearValue('#add-list-proc input');
                $('#dg').datagrid('reload');
                $('#add-list-proc').dialog('close');
//                alert('HandlerDone');
            }

            function openDailog(d, u, fn) {
                //                var o = new ListModel();

                $(d).show().dialog({
                    modal: true,
                    width: 500,
                    height: 400,
                    title: '會議內容',
                    //                    href: '/meet/new/',
                    cache: false,
                    collapsible: false,
                    minimizable: false,
                    maximized: true,
                    resizable: true,
                    toolbar: [
                        {
                            text: '保存',
                            iconCls: 'icon-ok',
                            handler: function() {
                                if (CheckIsSave()) {
                                    var o = new ContainerModel();
                                    SaveList(o, u, fn);
                                }
                            }
                        }, '-', {
                            text: '關閉',
                            iconCls: 'icon-no',
                            handler: function() {
                                fn();
                                //                                $('#txtId').val('');
                                //                                $('#txtName').val('');
                                //                                //                                $.messager.alert('info', mode);
                                //                                $('#add-list-proc').dialog('close');
                            }
                        }
                    ]
                });
            }

            
            @*-->
            o:ContainerModel
            u:URL
            d:Div
            dg:DataGrid重載數據使用
            fn:保存成功后回調函數
            *@
            //保存會議
            function SaveList(o, u, fn) {
                //                if (CheckIsSave()) {
                //                    var o = new ContainerModel();
                $.ajax({
                    url: u, //'/meetmaintenance/action',
                    dataType: 'json',
                    data: JSON.stringify(o),
                    contentType: 'application/json',
                    type: 'post',
                    success: function (data) {
                        //alert(data.result);
                        if (data.result <= '0') {
                            $.messager.alert('提示', '保存失敗,消息:' + data.errmsg, 'info');
                        } else {
                            $.messager.alert('提示', '保存成功!', 'info', function () {
                                fn();
                                //                                    $('#dg').datagrid('reload');
                                //                                    $(dg).datagrid('reload');
                                //                                    $(d).dialog('close');
                                //                                    $('#txtId').val('');
                                //                                    $('#txtName').val('');
                                //                                $.messager.alert('info', mode);
                                //                                    $('#add-list-proc').dialog('close');
                            });
                            //                                $('#dg').datagrid('reload');

                        }
                    }
                });
                //                };
            };

            //新增面板
            function addPanels() {
                if ($.trim($('#txtMtListId').val()) == '') {
                    $('#txtMtListId').val('');
                    $.messager.alert('提示', '請輸入會議事項!', 'info');
                    return false;
                }
                //var sysid = 
                $.ajax({
                    url: '/meetmaintenance/getguid',
                    type: 'post',
                    dataType:'json',
                    contentType:'application/json',
                    success: function(data) {
//                        alert(data);
                        if (data.result != '1') {
                            $.messager.alert('提示', '系統異常!', 'info');
                            return false;
                        }
                        $('#meetlistpanels').accordion('add', {
                            title: $('#txtMtListId').val(),
                            content: '<div style="padding:1px;overflow:auto;" id="listdetail"><input type="text" id="listsysid" value=""/><textarea cols="100" rows="4" id="txtListContent' + panelIdx + '" data-sysid="'+data.sysid+'"></textarea></div>'
                            //content: '<div style="padding:1px;overflow:auto;"><input id="txtListContent' + panelIdx + '" data-sysid='+data+'/></div>'
                        });
                        $('#txtMtListId').val('');
                        panelIdx++;
                    }
                });
            };

//            function ListExists() {
//                var guid = $('#txtMtListId').val();
//                $.ajax({
//                    url: '/MeetMaintenance/GetGUIDExists',
//                    data: 'guid=' + $('#txtMtListId').val(),
//                    type: 'get',
//                    success: function (data) {
//                        alert(data);
//                    }
//                });
//            }

            function GetGuid() {
                $.ajax({
                    url: '/meetmaintenance/getguid',
                    type: 'POST',
                    success: function (data) {
                        //alert(data);
                        if (data.result != '1') {
                            $.messager.alert('提示', '系統異常!', 'info');
                            return false;
                        } else {
                            $('#txtSysId').val(data.sysid);
                            return true;
                        }
                    }
                });
            }

            function GetValues() {
                
                $('#meetlistpanels textarea').each(function() {
                    console.log($(this).val());
                    alert($(this).data('sysid'));
                } );
            }

            function GetValuesDetail() {
                $('#meetlistpanels #listdetail textarea').each(function() {
                    console.log($(this).val());
                });
            }

            $(function () {
                initWndData();
            });

            function initWndData() {
                //下拉選擇框
                $('#cc').combo({
                    required: true,
                    editable: false
                });
                $('#sp').appendTo($('#cc').combo('panel'));
                $('#sp input').click(function () {
                    var v = $(this).val();
                    var s = $(this).next('span').text();
                    $('#cc').combo('setValue', v).combo('setText', s).combo('hidePanel');
                });

                //初始化表格數據
                $('#dg').datagrid({
                    url: '/meetmaintenance/getmeet',
                    method: 'get',
                    singleSelect: true,
                    fit: true,
                    pagination: true,
                    rownumbers: true,
                    pageSize: 10,
                    pageList: [5, 10, 15, 20],
                    remoteSort: false,
                    columns: [
                        [
                            { field: 'sys_id', title: 'sysid', width: 1, hidden: true },
                            { field: 'mt_id', title: '會議編號', width: '20%' },
                            { field: 'mt_time', title: '會議名稱', width: '15%' },
                            { field: 'mt_dte', title: '會議日期', width: '30%' },
                            { field: 'mt_time', title: '會議時間', width: '15%' },
                            { field: 'addr', title: '會議地點', width: '20%' }
                        ]
                    ]
                });
            };

        
        </script>

        @*<script src="../../Content/js/MeetMaintenance.js" type="text/javascript"></script>*@
        
    </body>
</html>
